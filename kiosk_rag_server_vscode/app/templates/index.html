{% extends "base.html" %}
{% block content %}
<section class="card">
  <h2>Ask a question</h2>
  <form id="askForm">
    <input type="text" id="q" name="q" placeholder="e.g., Are advising hours open today?" required>
    <button type="submit">Ask</button>
  </form>
  <pre id="answer" class="answer"></pre>
  <script>
    const form = document.getElementById('askForm');
    const pre = document.getElementById('answer');
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const q = document.getElementById('q').value;
      pre.textContent = 'Thinking...';
      const res = await fetch('/api/ask', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({query: q})
      });
      const data = await res.json();
      if (!data.ok) { pre.textContent = 'Error: ' + (data.error || 'unknown'); return; }
      let srcs = (data.sources || []).map(s => `- ${s.title} (${s.updated_at}) â€” ${s.source}`).join('\n');
      pre.textContent = `ANSWER:\n${data.answer}\n\nSOURCES:\n${srcs}`;
    });
  </script>
</section>
{% endblock %}
