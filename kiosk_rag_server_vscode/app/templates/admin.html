{% extends "base.html" %}
{% block content %}
<section class="grid">
  <div class="card">
    <h2>Add page (paste text)</h2>
    <form method="post" action="/admin/add_text">
      <label>Title</label>
      <input type="text" name="title" required>
      <label>URL (optional)</label>
      <input type="url" name="url">
      <label>Body</label>
      <textarea name="body" rows="10" required></textarea>
      <button type="submit">Save & Index</button>
    </form>
  </div>
  <div class="card">
    <h2>Fetch from URL</h2>
    <form method="post" action="/admin/fetch_url">
      <label>URL (allowed site)</label>
      <input type="url" name="url" required>
      <button type="submit">Fetch & Index</button>
    </form>
    <form onsubmit="ingest(event)" class="mt">
      <button type="submit">Re-index data/pages</button>
    </form>
    <pre id="ingestOut"></pre>
    <script>
      async function ingest(e){
        e.preventDefault();
        const pre = document.getElementById('ingestOut');
        pre.textContent = 'Re-indexing...';
        const res = await fetch('/api/ingest', {method: 'POST'});
        const data = await res.json();
        pre.textContent = JSON.stringify(data, null, 2);
      }
    </script>
  </div>
</section>

<section class="card">
  <h2>Existing local files</h2>
  {% if files %}
    <ul>
    {% for f in files %}
      <li>{{ f }}</li>
    {% endfor %}
    </ul>
  {% else %}
    <p>No files yet.</p>
  {% endif %}
</section>
{% endblock %}
